#include "CF5642C.h"
#include "sccb.h"
               // Device header
#include "sysdelay.h"
#include <absacc.h> 
#include "rtthread.h"
#include "camera.h"
#define DCMI_DR_ADDRESS       	0x50050028 // 0x50000000 + 0x00050000 + 0x00000028
__IO uint32_t RAM_Buffer[JPEG_BUFFER_CNT*(JPEG_BUFFER_SIZE+1)] __attribute__((at(0xD0000000))); //__at (0xD0000000);
extern int dma_freebuf_ok;
int First_Capture = 1;
int frex_send_ok=0;
void CF5642C_GPIO_Init(void)
{
  GPIO_InitTypeDef GPIO_InitStructure;
	
	RCC_AHB1PeriphClockCmd(RCC_AHB1Periph_GPIOA | RCC_AHB1Periph_GPIOB | RCC_AHB1Periph_GPIOC \
                      	| RCC_AHB1Periph_GPIOD | RCC_AHB1Periph_GPIOE | RCC_AHB1Periph_GPIOH \
												| RCC_AHB1Periph_GPIOI , ENABLE);   
	
	GPIO_PinAFConfig(CF5642C_HSYNC_GPIO_PORT, GPIO_PinSource4, GPIO_AF_DCMI);//DCMI_HSYNC   *****	
	GPIO_PinAFConfig(CF5642C_PIXCLK_GPIO_PORT, GPIO_PinSource6, GPIO_AF_DCMI);    //PIXCLK
	GPIO_PinAFConfig(CF5642C_VSYNC_GPIO_PORT, GPIO_PinSource7, GPIO_AF_DCMI);//DCMI_VSYNC 
	GPIO_PinAFConfig(CF5642C_D6_GPIO_PORT, GPIO_PinSource8, GPIO_AF_DCMI);   //D6
	GPIO_PinAFConfig(CF5642C_D7_GPIO_PORT, GPIO_PinSource9, GPIO_AF_DCMI);   //D7
	GPIO_PinAFConfig(CF5642C_D0_GPIO_PORT, GPIO_PinSource6, GPIO_AF_DCMI);   //D0
	GPIO_PinAFConfig(CF5642C_D1_GPIO_PORT, GPIO_PinSource7, GPIO_AF_DCMI);   //D1
	GPIO_PinAFConfig(CF5642C_D2_GPIO_PORT, GPIO_PinSource8, GPIO_AF_DCMI);   //D2
	GPIO_PinAFConfig(CF5642C_D4_GPIO_PORT, GPIO_PinSource11, GPIO_AF_DCMI);  //D4
	GPIO_PinAFConfig(CF5642C_D5_GPIO_PORT, GPIO_PinSource3, GPIO_AF_DCMI);   //D5
	GPIO_PinAFConfig(CF5642C_D3_GPIO_PORT, GPIO_PinSource12, GPIO_AF_DCMI);  //D3
   // HSYNC
  GPIO_InitStructure.GPIO_Pin = CF5642C_HSYNC_PIN ;
  GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF ;
  GPIO_InitStructure.GPIO_Speed = GPIO_Speed_100MHz ;
	GPIO_InitStructure.GPIO_OType = GPIO_OType_PP ;
	GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_UP ;
  GPIO_Init(CF5642C_HSYNC_GPIO_PORT, &GPIO_InitStructure);
 //PIXCLK
  GPIO_InitStructure.GPIO_Pin = CF5642C_PIXCLK_PIN ;
  GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF ;
  GPIO_InitStructure.GPIO_Speed = GPIO_Speed_100MHz ;
	GPIO_InitStructure.GPIO_OType = GPIO_OType_PP ;
	GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_UP ;
  GPIO_Init(CF5642C_PIXCLK_GPIO_PORT, &GPIO_InitStructure);

	//VSYNC D6 D7 
  GPIO_InitStructure.GPIO_Pin = CF5642C_VSYNC_PIN | CF5642C_D6_PIN | CF5642C_D7_PIN ;
  GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF ;
  GPIO_InitStructure.GPIO_Speed = GPIO_Speed_100MHz ;
	GPIO_InitStructure.GPIO_OType = GPIO_OType_PP ;
	GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_UP ;
  GPIO_Init(GPIOB, &GPIO_InitStructure);
	//D0 D1 D2  D4
  GPIO_InitStructure.GPIO_Pin = CF5642C_D0_PIN | CF5642C_D1_PIN | CF5642C_D2_PIN | CF5642C_D4_PIN ;
  GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF ;
  GPIO_InitStructure.GPIO_Speed = GPIO_Speed_100MHz ;
	GPIO_InitStructure.GPIO_OType = GPIO_OType_PP ;
	GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_UP ;
  GPIO_Init(GPIOC, &GPIO_InitStructure);
	//D5 
  GPIO_InitStructure.GPIO_Pin = CF5642C_D5_PIN ;
  GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF ;
  GPIO_InitStructure.GPIO_Speed = GPIO_Speed_100MHz ;
	GPIO_InitStructure.GPIO_OType = GPIO_OType_PP ;
	GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_UP ;
  GPIO_Init(GPIOD, &GPIO_InitStructure);
	//D3
	GPIO_InitStructure.GPIO_Pin = CF5642C_D3_PIN ;
  GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF ;
  GPIO_InitStructure.GPIO_Speed = GPIO_Speed_100MHz ;
	GPIO_InitStructure.GPIO_OType = GPIO_OType_PP ;
	GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_UP ;
  GPIO_Init(GPIOH, &GPIO_InitStructure);
}

void CF5642C_DCMI_Init(void)
{
		DCMI_InitTypeDef  DCMI_InitStructure;
		NVIC_InitTypeDef NVIC_InitStructure;
		//DCMI
		RCC_AHB2PeriphClockCmd(RCC_AHB2Periph_DCMI, ENABLE);
	
		DCMI_DeInit();
		DCMI_InitStructure.DCMI_CaptureMode = DCMI_CaptureMode_Continuous; //DCMI_CaptureMode_SnapShot;   //DCMI_CaptureMode_Continuous; //连续模式		  只能是连续模式
		DCMI_InitStructure.DCMI_SynchroMode = DCMI_SynchroMode_Hardware;	 //硬件
		DCMI_InitStructure.DCMI_PCKPolarity = DCMI_PCKPolarity_Rising;	 //下降捕获
		DCMI_InitStructure.DCMI_VSPolarity = DCMI_VSPolarity_High;		 //极性高
		DCMI_InitStructure.DCMI_HSPolarity = DCMI_HSPolarity_Low;		 //极性高
		DCMI_InitStructure.DCMI_CaptureRate = DCMI_CaptureRate_All_Frame;	 //捕获所有频率	  ALL的时候 速度最快
		DCMI_InitStructure.DCMI_ExtendedDataMode = DCMI_ExtendedDataMode_8b;		 //只能8B 改为其他的 全屏蓝
		DCMI_Init(&DCMI_InitStructure);
	
		DCMI_JPEGCmd(ENABLE);
		DCMI_ITConfig(DCMI_IT_VSYNC,ENABLE);//DCMI 捕获完成中断
    NVIC_SetVectorTable(NVIC_VectTab_FLASH, 0x0);
	
  	NVIC_PriorityGroupConfig(NVIC_PriorityGroup_2);
  	NVIC_InitStructure.NVIC_IRQChannel = DCMI_IRQn;
  	NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority = 1;
  	NVIC_InitStructure.NVIC_IRQChannelSubPriority = 1;
  	NVIC_InitStructure.NVIC_IRQChannelCmd = ENABLE;
  	NVIC_Init(&NVIC_InitStructure);
}
void CF5642C_DMA_Init(void)
{
	DMA_InitTypeDef   DMA_InitStructure;
	NVIC_InitTypeDef NVIC_InitStructure;
	RCC_AHB1PeriphClockCmd(RCC_AHB1Periph_DMA2, ENABLE);
	//DMA
	DMA_DeInit(DMA2_Stream1);		 //只有STREAM1的通道1是对应DCMI的
	DMA_InitStructure.DMA_Channel = DMA_Channel_1;  
	DMA_InitStructure.DMA_PeripheralBaseAddr =  (uint32_t)(&DCMI->DR);     //DCMI_DR_ADDRESS;	
	DMA_InitStructure.DMA_Memory0BaseAddr =(uint32_t) RAM_Buffer;
	
	DMA_InitStructure.DMA_DIR = DMA_DIR_PeripheralToMemory;
	DMA_InitStructure.DMA_BufferSize = JPEG_BUFFER_SIZE; //picture_x * picture_y * 2 / 4; //大小由发送的源决定
	DMA_InitStructure.DMA_PeripheralInc = DMA_PeripheralInc_Disable;
	DMA_InitStructure.DMA_MemoryInc = DMA_MemoryInc_Enable;    // DMA_MemoryInc_Disable; 
	DMA_InitStructure.DMA_PeripheralDataSize = DMA_PeripheralDataSize_Word;//32位
	DMA_InitStructure.DMA_MemoryDataSize = DMA_MemoryDataSize_Word;//16位
	DMA_InitStructure.DMA_Mode = DMA_Mode_Normal;//DMA_Mode_Circular
	DMA_InitStructure.DMA_Priority = DMA_Priority_VeryHigh;
	DMA_InitStructure.DMA_FIFOMode = DMA_FIFOMode_Enable;
	DMA_InitStructure.DMA_FIFOThreshold = DMA_FIFOThreshold_Full;
	DMA_InitStructure.DMA_MemoryBurst = DMA_MemoryBurst_Single;
	DMA_InitStructure.DMA_PeripheralBurst = DMA_PeripheralBurst_Single;
	
	DMA_DoubleBufferModeConfig(DMA2_Stream1,(uint32_t)&RAM_Buffer[JPEG_BUFFER_SIZE],DMA_Memory_0);
	DMA_DoubleBufferModeCmd(DMA2_Stream1,ENABLE);
	
	DMA_Init(DMA2_Stream1, &DMA_InitStructure);	
	
	dma_freebuf_ok=0;
	
	NVIC_PriorityGroupConfig(NVIC_PriorityGroup_1);
	NVIC_InitStructure.NVIC_IRQChannel = DMA2_Stream1_IRQn;
	NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority = 1;
	NVIC_InitStructure.NVIC_IRQChannelSubPriority = 2;
	NVIC_InitStructure.NVIC_IRQChannelCmd = ENABLE;
	NVIC_Init(&NVIC_InitStructure);
	DMA_ITConfig(DMA2_Stream1,DMA_IT_TC,ENABLE);//

}
void OverTrans_DMA_Init(uint32_t *Buffer)
{
	DMA_InitTypeDef   DMA_InitStructure;
	DMA_Cmd(DMA2_Stream1, DISABLE);
	DMA_DeInit(DMA2_Stream1);		 //只有STREAM1的通道1是对应DCMI的
	DMA_InitStructure.DMA_Channel = DMA_Channel_1;  
	DMA_InitStructure.DMA_PeripheralBaseAddr =  (uint32_t)(&DCMI->DR);     //DCMI_DR_ADDRESS;	
	DMA_InitStructure.DMA_Memory0BaseAddr =(uint32_t)Buffer;	
	DMA_InitStructure.DMA_DIR = DMA_DIR_PeripheralToMemory;
	DMA_InitStructure.DMA_BufferSize = JPEG_BUFFER_SIZE; //picture_x * picture_y * 2 / 4; //大小由发送的源决定
	DMA_InitStructure.DMA_PeripheralInc = DMA_PeripheralInc_Disable;
	DMA_InitStructure.DMA_MemoryInc = DMA_MemoryInc_Enable;    // DMA_MemoryInc_Disable; 
	DMA_InitStructure.DMA_PeripheralDataSize = DMA_PeripheralDataSize_Word;//32位
	DMA_InitStructure.DMA_MemoryDataSize = DMA_MemoryDataSize_Word;//16位
	DMA_InitStructure.DMA_Mode = DMA_Mode_Normal;//DMA_Mode_Circular
	DMA_InitStructure.DMA_Priority = DMA_Priority_VeryHigh;
	DMA_InitStructure.DMA_FIFOMode = DMA_FIFOMode_Enable;
	DMA_InitStructure.DMA_FIFOThreshold = DMA_FIFOThreshold_Full;
	DMA_InitStructure.DMA_MemoryBurst = DMA_MemoryBurst_Single;
	DMA_InitStructure.DMA_PeripheralBurst = DMA_PeripheralBurst_Single;	
		
	
	DMA_Init(DMA2_Stream1, &DMA_InitStructure);	
	DMA_ITConfig(DMA2_Stream1,DMA_IT_TC,ENABLE);//
}
/********************************************************************

********************************************************************/




unsigned char write_i2c(unsigned int regID, unsigned char regDat)
{//返回值为1  为正常
	SCCB_Start();
	if(0==SCCB_Write(0x78))//
	{
		SCCB_Stop();
		return(0);
	}
	Delay_Nus(20);
  if(0==SCCB_Write((unsigned char)(regID>>8)))
	{
		SCCB_Stop();
		return(0);
	}
	Delay_Nus(20);
  if(0==SCCB_Write((unsigned char)regID))
	{
		SCCB_Stop();
		return(0);
	}
	Delay_Nus(20);
  if(0==SCCB_Write(regDat))
	{
		SCCB_Stop();
		return(0);
	}
  	SCCB_Stop();
	
  	return(1);
}

////////////////////////////

unsigned char Read_i2c(unsigned int regID, unsigned char *regDat)
{
//返回值为1   读正常
	SCCB_Start();
	if(0==SCCB_Write(0x78))
	{
		SCCB_Stop();
		return(0);
	}
	Delay_Nus(20);
	Delay_Nus(20);
	if(0==SCCB_Write((unsigned char)(regID>>8)))
	{
		SCCB_Stop();
		return(0);
	}
	Delay_Nus(20);
	if(0==SCCB_Write((unsigned char)regID))
	{
		SCCB_Stop();
		return(0);
	}
	Delay_Nus(20);
	SCCB_Stop();
	
	Delay_Nus(20);
	

	SCCB_Start();
	if(0==SCCB_Write(0x79))
	{
		SCCB_Stop();
		return(0);
	}
	Delay_Nus(20);
  	*regDat=SCCB_Read();
  	noAck();
  	SCCB_Stop();
  	return(1);
}



unsigned char QVGA_rgb565_Preview(void)
{
    

write_i2c(0x3103 ,0x93);
write_i2c(0x3008 ,0x82);
write_i2c(0x3017 ,0x7f);
write_i2c(0x3018 ,0xfc);
write_i2c(0x3810 ,0xc2);
write_i2c(0x3615 ,0xf0);
write_i2c(0x3000 ,0x00);
write_i2c(0x3001 ,0x00);
write_i2c(0x3002 ,0x00);
write_i2c(0x3003 ,0x00);
write_i2c(0x3000 ,0xf8);
write_i2c(0x3001 ,0x48);

write_i2c(0x3002 ,0x5c);
write_i2c(0x3003 ,0x02);
write_i2c(0x3004 ,0x07);
write_i2c(0x3005 ,0xb7);
write_i2c(0x3006 ,0x43);
write_i2c(0x3007 ,0x37);
write_i2c(0x3011 ,0x08);
write_i2c(0x3010 ,0x10);
write_i2c(0x460c ,0x22);
write_i2c(0x3815 ,0x04);
write_i2c(0x370d ,0x06);
write_i2c(0x370c ,0xa0);
write_i2c(0x3602 ,0xfc);
write_i2c(0x3612 ,0xff);
write_i2c(0x3634 ,0xc0);
write_i2c(0x3613 ,0x00);
write_i2c(0x3605 ,0x7c);
write_i2c(0x3621 ,0x09);
write_i2c(0x3622 ,0x00);
write_i2c(0x3604 ,0x40);
write_i2c(0x3603 ,0xa7);
write_i2c(0x3603 ,0x27);
write_i2c(0x4000 ,0x21);
write_i2c(0x401d ,0x02);
write_i2c(0x3600 ,0x54);
write_i2c(0x3605 ,0x04);
write_i2c(0x3606 ,0x3f);
write_i2c(0x3c01 ,0x80);
write_i2c(0x5000 ,0x4f);
write_i2c(0x5020 ,0x04);
write_i2c(0x5181 ,0x79);
write_i2c(0x5182 ,0x00);
write_i2c(0x5185 ,0x22);
write_i2c(0x5197 ,0x01);
write_i2c(0x5001 ,0xff);
write_i2c(0x5500 ,0x0a);
write_i2c(0x5504 ,0x00);
write_i2c(0x5505 ,0x7f);
write_i2c(0x5080 ,0x08);
write_i2c(0x300e ,0x18);
write_i2c(0x4610 ,0x00);
write_i2c(0x471d ,0x05);
write_i2c(0x4708 ,0x06);
write_i2c(0x3710 ,0x10);
write_i2c(0x3632 ,0x41);
write_i2c(0x3702 ,0x40);
write_i2c(0x3620 ,0x37);
write_i2c(0x3631 ,0x01);

write_i2c(0x3808 ,0x02);
write_i2c(0x3809 ,0x80);
write_i2c(0x380a ,0x01);
write_i2c(0x380b ,0xe0);
write_i2c(0x380e ,0x07);
write_i2c(0x380f ,0xd0);
write_i2c(0x501f ,0x00);
write_i2c(0x5000 ,0x4f);
write_i2c(0x4300 ,0x30);
write_i2c(0x3503 ,0x07);
write_i2c(0x3501 ,0x73);
write_i2c(0x3502 ,0x80);
write_i2c(0x350b ,0x00);
write_i2c(0x3503 ,0x07);
write_i2c(0x3824 ,0x11);
write_i2c(0x3501 ,0x1e);
write_i2c(0x3502 ,0x80);
write_i2c(0x350b ,0x7f);
write_i2c(0x380c ,0x0c);
write_i2c(0x380d ,0x80);
write_i2c(0x380e ,0x03);
write_i2c(0x380f ,0xe8);
write_i2c(0x3a0d ,0x04);
write_i2c(0x3a0e ,0x03);
write_i2c(0x3818 ,0xc1);
write_i2c(0x3705 ,0xdb);
write_i2c(0x370a ,0x81);
write_i2c(0x3801 ,0x80);
write_i2c(0x3621 ,0xc7);
write_i2c(0x3801 ,0x50);
write_i2c(0x3803 ,0x08);
write_i2c(0x3827 ,0x08);
write_i2c(0x3810 ,0xc0);
write_i2c(0x3804 ,0x05);
write_i2c(0x3805 ,0x00);
write_i2c(0x5682 ,0x05);
write_i2c(0x5683 ,0x00);
write_i2c(0x3806 ,0x03);
write_i2c(0x3807 ,0xc0);
write_i2c(0x5686 ,0x03);
write_i2c(0x5687 ,0xc0);
write_i2c(0x3a00 ,0x78);
write_i2c(0x3a1a ,0x04);
write_i2c(0x3a13 ,0x30);
write_i2c(0x3a18 ,0x00);
write_i2c(0x3a19 ,0x7c);
write_i2c(0x3a08 ,0x12);
write_i2c(0x3a09 ,0xc0);

write_i2c(0x3a0a ,0x0f);
write_i2c(0x3a0b ,0xa0);
write_i2c(0x3004 ,0xff);
write_i2c(0x350c ,0x07);
write_i2c(0x350d ,0xd0);
write_i2c(0x3500 ,0x00);
write_i2c(0x3501 ,0x00);
write_i2c(0x3502 ,0x00);
write_i2c(0x350a ,0x00);
write_i2c(0x350b ,0x00);
write_i2c(0x3503 ,0x00);
write_i2c(0x528a ,0x02);
write_i2c(0x528b ,0x04);
write_i2c(0x528c ,0x08);
write_i2c(0x528d ,0x08);
write_i2c(0x528e ,0x08);
write_i2c(0x528f ,0x10);
write_i2c(0x5290 ,0x10);
write_i2c(0x5292 ,0x00);
write_i2c(0x5293 ,0x02);
write_i2c(0x5294 ,0x00);
write_i2c(0x5295 ,0x02);
write_i2c(0x5296 ,0x00);
write_i2c(0x5297 ,0x02);
write_i2c(0x5298 ,0x00);
write_i2c(0x5299 ,0x02);
write_i2c(0x529a ,0x00);
write_i2c(0x529b ,0x02);
write_i2c(0x529c ,0x00);
write_i2c(0x529d ,0x02);
write_i2c(0x529e ,0x00);
write_i2c(0x529f ,0x02);
write_i2c(0x3a0f ,0x3c);
write_i2c(0x3a10 ,0x30);
write_i2c(0x3a1b ,0x3c);
write_i2c(0x3a1e ,0x30);
write_i2c(0x3a11 ,0x70);
write_i2c(0x3a1f ,0x10);
write_i2c(0x3030 ,0x0b);
write_i2c(0x3a02 ,0x00);
write_i2c(0x3a03 ,0x7d);
write_i2c(0x3a04 ,0x00);
write_i2c(0x3a14 ,0x00);
write_i2c(0x3a15 ,0x7d);
write_i2c(0x3a16 ,0x00);
write_i2c(0x3a00 ,0x7c);
write_i2c(0x3a08 ,0x09);
write_i2c(0x3a09 ,0x60);

write_i2c(0x3a0a ,0x07);
write_i2c(0x3a0b ,0xd0);
write_i2c(0x3a0d ,0x08);
write_i2c(0x3a0e ,0x06);
write_i2c(0x5193 ,0x70);
write_i2c(0x3620 ,0x57);
write_i2c(0x3703 ,0x98);
write_i2c(0x3704 ,0x1c);
write_i2c(0x589b ,0x04);
write_i2c(0x589a ,0xc5);
write_i2c(0x528a ,0x00);
write_i2c(0x528b ,0x02);
write_i2c(0x528c ,0x08);
write_i2c(0x528d ,0x10);
write_i2c(0x528e ,0x20);
write_i2c(0x528f ,0x28);
write_i2c(0x5290 ,0x30);
write_i2c(0x5292 ,0x00);
write_i2c(0x5293 ,0x00);
write_i2c(0x5294 ,0x00);
write_i2c(0x5295 ,0x02);
write_i2c(0x5296 ,0x00);
write_i2c(0x5297 ,0x08);
write_i2c(0x5298 ,0x00);
write_i2c(0x5299 ,0x10);
write_i2c(0x529a ,0x00);
write_i2c(0x529b ,0x20);
write_i2c(0x529c ,0x00);
write_i2c(0x529d ,0x28);
write_i2c(0x529e ,0x00);
write_i2c(0x529f ,0x30);
write_i2c(0x5282 ,0x00);
write_i2c(0x5300 ,0x00);
write_i2c(0x5301 ,0x20);
write_i2c(0x5302 ,0x00);
write_i2c(0x5303 ,0x7c);
write_i2c(0x530c ,0x00);
write_i2c(0x530d ,0x0c);
write_i2c(0x530e ,0x20);
write_i2c(0x530f ,0x80);
write_i2c(0x5310 ,0x20);
write_i2c(0x5311 ,0x80);
write_i2c(0x5308 ,0x20);
write_i2c(0x5309 ,0x40);
write_i2c(0x5304 ,0x00);
write_i2c(0x5305 ,0x30);
write_i2c(0x5306 ,0x00);
write_i2c(0x5307 ,0x80);

write_i2c(0x5314 ,0x08);
write_i2c(0x5315 ,0x20);
write_i2c(0x5319 ,0x30);
write_i2c(0x5316 ,0x10);
write_i2c(0x5317 ,0x08);
write_i2c(0x5318 ,0x02);
write_i2c(0x5380 ,0x01);
write_i2c(0x5381 ,0x00);
write_i2c(0x5382 ,0x00);
write_i2c(0x5383 ,0x4e);
write_i2c(0x5384 ,0x00);
write_i2c(0x5385 ,0x0f);
write_i2c(0x5386 ,0x00);
write_i2c(0x5387 ,0x00);
write_i2c(0x5388 ,0x01);
write_i2c(0x5389 ,0x15);
write_i2c(0x538a ,0x00);
write_i2c(0x538b ,0x31);
write_i2c(0x538c ,0x00);
write_i2c(0x538d ,0x00);
write_i2c(0x538e ,0x00);
write_i2c(0x538f ,0x0f);
write_i2c(0x5390 ,0x00);
write_i2c(0x5391 ,0xab);
write_i2c(0x5392 ,0x00);
write_i2c(0x5393 ,0xa2);
write_i2c(0x5394 ,0x08);
write_i2c(0x5480 ,0x14);
write_i2c(0x5481 ,0x21);
write_i2c(0x5482 ,0x36);
write_i2c(0x5483 ,0x57);
write_i2c(0x5484 ,0x65);
write_i2c(0x5485 ,0x71);
write_i2c(0x5486 ,0x7d);
write_i2c(0x5487 ,0x87);
write_i2c(0x5488 ,0x91);
write_i2c(0x5489 ,0x9a);
write_i2c(0x548a ,0xaa);
write_i2c(0x548b ,0xb8);
write_i2c(0x548c ,0xcd);
write_i2c(0x548d ,0xdd);
write_i2c(0x548e ,0xea);
write_i2c(0x548f ,0x10);
write_i2c(0x5490 ,0x05);
write_i2c(0x5491 ,0x00);
write_i2c(0x5492 ,0x04);
write_i2c(0x5493 ,0x20);
write_i2c(0x5494 ,0x03);

write_i2c(0x5495 ,0x60);
write_i2c(0x5496 ,0x02);
write_i2c(0x5497 ,0xb8);
write_i2c(0x5498 ,0x02);
write_i2c(0x5499 ,0x86);
write_i2c(0x549a ,0x02);
write_i2c(0x549b ,0x5b);
write_i2c(0x549c ,0x02);
write_i2c(0x549d ,0x3b);
write_i2c(0x549e ,0x02);
write_i2c(0x549f ,0x1c);
write_i2c(0x54a0 ,0x02);
write_i2c(0x54a1 ,0x04);
write_i2c(0x54a2 ,0x01);
write_i2c(0x54a3 ,0xed);
write_i2c(0x54a4 ,0x01);
write_i2c(0x54a5 ,0xc5);
write_i2c(0x54a6 ,0x01);
write_i2c(0x54a7 ,0xa5);
write_i2c(0x54a8 ,0x01);
write_i2c(0x54a9 ,0x6c);
write_i2c(0x54aa ,0x01);
write_i2c(0x54ab ,0x41);
write_i2c(0x54ac ,0x01);
write_i2c(0x54ad ,0x20);
write_i2c(0x54ae ,0x00);
write_i2c(0x54af ,0x16);
write_i2c(0x3406 ,0x00);
write_i2c(0x5192 ,0x04);
write_i2c(0x5191 ,0xf8);
write_i2c(0x5193 ,0x70);
write_i2c(0x5194 ,0xf0);
write_i2c(0x5195 ,0xf0);
write_i2c(0x518d ,0x3d);
write_i2c(0x518f ,0x54);
write_i2c(0x518e ,0x3d);
write_i2c(0x5190 ,0x54);
write_i2c(0x518b ,0xc0);
write_i2c(0x518c ,0xbd);
write_i2c(0x5187 ,0x18);
write_i2c(0x5188 ,0x18);
write_i2c(0x5189 ,0x6e);
write_i2c(0x518a ,0x68);
write_i2c(0x5186 ,0x1c);
write_i2c(0x5181 ,0x50);
write_i2c(0x5184 ,0x25);
write_i2c(0x5182 ,0x11);
write_i2c(0x5183 ,0x14);

write_i2c(0x5184 ,0x25);
write_i2c(0x5185 ,0x24);
write_i2c(0x5025 ,0x82);
write_i2c(0x3a0f ,0x7e);
write_i2c(0x3a10 ,0x72);
write_i2c(0x3a1b ,0x80);
write_i2c(0x3a1e ,0x70);
write_i2c(0x3a11 ,0xd0);
write_i2c(0x3a1f ,0x40);
write_i2c(0x5583 ,0x40);
write_i2c(0x5584 ,0x40);
write_i2c(0x5580 ,0x02);
write_i2c(0x3633 ,0x07);
write_i2c(0x3702 ,0x10);
write_i2c(0x3703 ,0xb2);
write_i2c(0x3704 ,0x18);
write_i2c(0x370b ,0x40);
write_i2c(0x370d ,0x02);
write_i2c(0x3620 ,0x52);

write_i2c(0x3808 ,0x01);
write_i2c(0x3809 ,0x40);
write_i2c(0x380a ,0x00);
write_i2c(0x380b ,0xf0);


write_i2c(0x3a00 ,0x78);





///画面旋转方向
write_i2c(0x3818,0x81); 
write_i2c(0x3621,0xe7); 


////Contrast +1 
//write_i2c(0x5001 ,0xff);  
//write_i2c(0x5580 ,0x04);  
//write_i2c(0x5587 ,0x24); 
//write_i2c(0x5588 ,0x24); 
//write_i2c(0x558a ,0x00);  
/////Saturation 0 
//write_i2c(0x5001 ,0xff);  
//write_i2c(0x5583 ,0x45); 
//write_i2c(0x5584 ,0x45); 
//write_i2c(0x5580 ,0x02);  
////Brightness +1 
//write_i2c(0x5001 ,0xff);  
//write_i2c(0x5589 ,0x10);
//write_i2c(0x5580 ,0x04);  
//write_i2c(0x558a ,0x00); 
////Advanced AWB  
//write_i2c(0x3406 ,0x0 );
//write_i2c(0x5192 ,0x04); 
//write_i2c(0x5191 ,0xf8); 
//write_i2c(0x518d ,0x26);
//write_i2c(0x518f ,0x42);
//write_i2c(0x518e ,0x2b); 
//write_i2c(0x5190 ,0x42); 
//write_i2c(0x518b ,0xd0);
//write_i2c(0x518c ,0xbd);                            
//write_i2c(0x5187 ,0x18);
//write_i2c(0x5188 ,0x18);
//write_i2c(0x5189 ,0x56); 
//write_i2c(0x518a ,0x5c); 
//write_i2c(0x5186 ,0x1c); 
//     write_i2c(0x5181 ,0x50); 
//     write_i2c(0x5184 ,0x20);
//     write_i2c(0x5182 ,0x11);
//     write_i2c(0x5183 ,0x0 );
////ev1.3
//     write_i2c(0x3a0f ,0x58); 
//     write_i2c(0x3a10 ,0x50); 
//     write_i2c(0x3a11 ,0x91); 
//     write_i2c(0x3a1b ,0x58) ;
//     write_i2c(0x3a1e ,0x50); 
//     write_i2c(0x3a1f ,0x20); 

//     //hue +30 degree      
//     write_i2c(0x5580 ,0x01); 
//     write_i2c(0x5581 ,0x6f); 
//     write_i2c(0x5582 ,0x20); 
//     write_i2c(0x558a ,0x01);
      ////RGB565
     write_i2c(0x501e ,0x2a);//
     write_i2c(0x5002 ,0xf8); ///////
     write_i2c(0x501f ,0x01); 
     write_i2c(0x4300 ,0x61);//, /////////////// 
   //qvga out
     write_i2c(0x3808 ,0x01); 
     write_i2c(0x3809 ,0x40);//320
     write_i2c(0x380a ,0x00);
     write_i2c(0x380b ,0xf0); //240
//		 
//// write_i2c(0x380c ,0x0c); 
//// write_i2c(0x380d ,0x80); 
//// write_i2c(0x380e ,0x03); 
//// write_i2c(0x380f ,0xe8);   
///* 
//     write_i2c(0x460c ,0x22);  
//     write_i2c(0x460b ,0x37);  
//     write_i2c(0x471d ,0x00);  
//     write_i2c(0x3002 ,0x0c);  
//     write_i2c(0x3002 ,0x5c); 
//     write_i2c(0x4713 ,0x02);  
//     write_i2c(0x471c ,0xd0);  
//     write_i2c(0x3815 ,0x04);  
//     write_i2c(0x3818 ,0x81);  
//     write_i2c(0x3006 ,0x43); 
//     write_i2c(0x3007 ,0x37); */
//   /*  */
     return 1 ;
}

unsigned char VGA_jpeg_Preview(void)
{

 /*
write_i2c(0x3000 ,0x00); 
write_i2c(0x3001 ,0x00); 
write_i2c(0x3002 ,0x00); 
write_i2c(0x3003 ,0x00);*/ 
write_i2c(0x3005 ,0xff); 
write_i2c(0x3006 ,0xff); 
write_i2c(0x3007 ,0x3f); 

write_i2c(0x350c ,0x07); 
write_i2c(0x350d ,0xd0); 
write_i2c(0x3602 ,0xe4); 
write_i2c(0x3612 ,0xac); 
write_i2c(0x3613 ,0x44); 
write_i2c(0x3621 ,0x27); 
write_i2c(0x3622 ,0x08); 
write_i2c(0x3623 ,0x22); 
write_i2c(0x3604 ,0x60); 
write_i2c(0x3705 ,0xda); 
write_i2c(0x370a ,0x80);
     
write_i2c(0x3808 ,0x02); 
write_i2c(0x3809 ,0x80);
write_i2c(0x380a ,0x01);
write_i2c(0x380b ,0xe0); 

write_i2c(0x4602 ,0x02); 
write_i2c(0x4603 ,0x80);
write_i2c(0x4604 ,0x01);
write_i2c(0x4605 ,0xe0); 
     
write_i2c(0x3800 ,0x1 );
write_i2c(0x3801 ,0x8A);
write_i2c(0x3802 ,0x0 );
write_i2c(0x3803 ,0xA ); 

write_i2c(0x3804 ,0xA ), 
write_i2c(0x3805 ,0x20);
write_i2c(0x3806 ,0x7 ); 
write_i2c(0x3807 ,0x98); 

write_i2c(0x3808 ,0x2 );
write_i2c(0x3809 ,0x80);
write_i2c(0x380a ,0x1 );
write_i2c(0x380b ,0xe0);
write_i2c(0x380c ,0xc );
write_i2c(0x380d ,0x80);
write_i2c(0x380e ,0x7 ); 
write_i2c(0x380f ,0xd0); 
write_i2c(0x5001 ,0x7f);
write_i2c(0x5680 ,0x0 );
write_i2c(0x5681 ,0x0 );
write_i2c(0x5682 ,0xA );
write_i2c(0x5683 ,0x20);
write_i2c(0x5684 ,0x0 );
write_i2c(0x5685 ,0x0 );
write_i2c(0x5686 ,0x7 );
write_i2c(0x5687 ,0x98); 

write_i2c(0x3815 ,0x44); 
write_i2c(0x3818 ,0xc8); 
write_i2c(0x3824 ,0x01); 
write_i2c(0x3827 ,0x0a); 
write_i2c(0x3a00 ,0x78);
write_i2c(0x3a0d ,0x10); 
write_i2c(0x3a0e ,0x0d); 
write_i2c(0x3a10 ,0x32); 
write_i2c(0x3a1b ,0x3c); 
write_i2c(0x3a1e ,0x32); 
write_i2c(0x3a11 ,0x80); 
write_i2c(0x3a1f ,0x20); 
write_i2c(0x3a00 ,0x78); 
write_i2c(0x460b ,0x35); 
write_i2c(0x471d ,0x00); 
write_i2c(0x4713 ,0x03);
write_i2c(0x471c ,0x50); 
write_i2c(0x5682 ,0x0a);
write_i2c(0x5683 ,0x20); 
write_i2c(0x5686 ,0x07); 
write_i2c(0x5687 ,0x98);
write_i2c(0x5001 ,0x7f);
write_i2c(0x589b ,0x00);
write_i2c(0x589a ,0xc0); 
write_i2c(0x4407 ,0x02);
write_i2c(0x589b ,0x00);
write_i2c(0x589a ,0xc0);
write_i2c(0x3002 ,0x0c);
write_i2c(0x3002 ,0x00); 
write_i2c(0x3503 ,0x00);

//Contrast +2  ??
write_i2c(0x5001 ,0xff);  
write_i2c(0x5580 ,0x04);  
write_i2c(0x5587 ,0x28); 
write_i2c(0x5588 ,0x28); 
write_i2c(0x558a ,0x00);  
///Saturation 1 
write_i2c(0x5001 ,0xff);  
write_i2c(0x5583 ,0x50); 
write_i2c(0x5584 ,0x50); 
write_i2c(0x5580 ,0x02);  
//Brightness +1 
write_i2c(0x5001 ,0xff);  
write_i2c(0x5589 ,0x10);
write_i2c(0x5580 ,0x04);  
write_i2c(0x558a ,0x00); 
//Advanced AWB  
write_i2c(0x3406 ,0x0 );
write_i2c(0x5192 ,0x04); 
write_i2c(0x5191 ,0xf8); 
write_i2c(0x518d ,0x26);
write_i2c(0x518f ,0x42);
write_i2c(0x518e ,0x2b); 
write_i2c(0x5190 ,0x42); 
write_i2c(0x518b ,0xd0);
write_i2c(0x518c ,0xbd);                            
write_i2c(0x5187 ,0x18);
write_i2c(0x5188 ,0x18);
write_i2c(0x5189 ,0x56); 
write_i2c(0x518a ,0x5c); 
write_i2c(0x5186 ,0x1c); 
     write_i2c(0x5181 ,0x50); 
     write_i2c(0x5184 ,0x20);
     write_i2c(0x5182 ,0x11);
     write_i2c(0x5183 ,0x0 );
//ev1.3
     write_i2c(0x3a0f ,0x58); 
     write_i2c(0x3a10 ,0x50); 
     write_i2c(0x3a11 ,0x91); 
     write_i2c(0x3a1b ,0x58) ;
     write_i2c(0x3a1e ,0x50); 
     write_i2c(0x3a1f ,0x20); 

     //hue +30 degree      
     write_i2c(0x5580 ,0x01); 
     write_i2c(0x5581 ,0x6f); 
     write_i2c(0x5582 ,0x20); 
     write_i2c(0x558a ,0x01);
return 1 ;
   
}

unsigned char XGA_jpeg_Preview(void)
{
  
write_i2c(0x3000 ,0x00); 
write_i2c(0x3001 ,0x00); 
write_i2c(0x3002 ,0x00); 
write_i2c(0x3003 ,0x00); 
write_i2c(0x3005 ,0xff); 
write_i2c(0x3006 ,0xff); 
write_i2c(0x3007 ,0x3f); 

write_i2c(0x350c ,0x07); 
write_i2c(0x350d ,0xd0); 
write_i2c(0x3602 ,0xe4); 
write_i2c(0x3612 ,0xac); 
write_i2c(0x3613 ,0x44); 
write_i2c(0x3621 ,0x27); 
write_i2c(0x3622 ,0x08); 
write_i2c(0x3623 ,0x22); 
write_i2c(0x3604 ,0x60); 
write_i2c(0x3705 ,0xda); 
write_i2c(0x370a ,0x80);  

write_i2c(0x3808 ,0x04); 
write_i2c(0x3809 ,0x00);
write_i2c(0x380a ,0x03);
write_i2c(0x380b ,0x00); 
write_i2c(0x4602 ,0x04); 
write_i2c(0x4603 ,0x00);
write_i2c(0x4604 ,0x03);
write_i2c(0x4605 ,0x00); 

write_i2c(0x3800 ,0x1 ); 
write_i2c(0x3801 ,0x8A);
write_i2c(0x3802 ,0x0 ); 
write_i2c(0x3803 ,0xA ); 
write_i2c(0x3804 ,0xA ); 
write_i2c(0x3805 ,0x20); 
write_i2c(0x3806 ,0x7 ); 
write_i2c(0x3807 ,0x98); 
write_i2c(0x3808 ,0x4 ); 
write_i2c(0x3809 ,0x0 ); 
write_i2c(0x380a ,0x3 ); 
write_i2c(0x380b ,0x0 ); 
write_i2c(0x380c ,0xc ); 
write_i2c(0x380d ,0x80);
write_i2c(0x380e ,0x7 ); 
write_i2c(0x380f ,0xd0); 
write_i2c(0x5001 ,0x7f); 
write_i2c(0x5680 ,0x0 ); 
write_i2c(0x5681 ,0x0 ); 
write_i2c(0x5682 ,0xA ); 
write_i2c(0x5683 ,0x20); 
write_i2c(0x5684 ,0x0 ); 
write_i2c(0x5685 ,0x0 ); 
write_i2c(0x5686 ,0x7 ); 
write_i2c(0x5687 ,0x98); 

write_i2c(0x3815 ,0x44); 
write_i2c(0x3818 ,0xc8); 
write_i2c(0x3824 ,0x01); 
write_i2c(0x3827 ,0x0a); 
write_i2c(0x3a00 ,0x78);
write_i2c(0x3a0d ,0x10); 
write_i2c(0x3a0e ,0x0d); 
write_i2c(0x3a10 ,0x32); 
write_i2c(0x3a1b ,0x3c); 
write_i2c(0x3a1e ,0x32); 
write_i2c(0x3a11 ,0x80); 
write_i2c(0x3a1f ,0x20); 
write_i2c(0x3a00 ,0x78); 
write_i2c(0x460b ,0x35); 
write_i2c(0x471d ,0x00); 
write_i2c(0x4713 ,0x03);
write_i2c(0x471c ,0x50); 
write_i2c(0x5682 ,0x0a);
write_i2c(0x5683 ,0x20); 
write_i2c(0x5686 ,0x07); 
write_i2c(0x5687 ,0x98);
write_i2c(0x5001 ,0x7f);
write_i2c(0x589b ,0x00);
write_i2c(0x589a ,0xc0); 
write_i2c(0x4407 ,0x02);
write_i2c(0x589b ,0x00);
write_i2c(0x589a ,0xc0);
write_i2c(0x3002 ,0x0c);
write_i2c(0x3002 ,0x00); 
write_i2c(0x3503 ,0x00);
  return 1 ;
}
void qvga_yuv_preview()
{
//	; for the setting , 24M Mlck input and 24M Plck output
//;15fps YUV mode
write_i2c(0x3103 ,0x11);
write_i2c(0x3008 ,0x82);
write_i2c(0x3008 ,0x42);
write_i2c(0x3103 ,0x03);
write_i2c(0x3017 ,0xff);
write_i2c(0x3018 ,0xff);
write_i2c(0x3034 ,0x1a);
write_i2c(0x3035 ,0x11);
write_i2c(0x3036 ,0x46);
write_i2c(0x3037 ,0x13);
write_i2c(0x3108 ,0x01);
write_i2c(0x3630 ,0x36);
write_i2c(0x3631 ,0x0e);
write_i2c(0x3632 ,0xe2);
write_i2c(0x3633 ,0x12);
write_i2c(0x3621 ,0xe0);
write_i2c(0x3704 ,0xa0);
write_i2c(0x3703 ,0x5a);
write_i2c(0x3715 ,0x78);
write_i2c(0x3717 ,0x01);
write_i2c(0x370b ,0x60);
write_i2c(0x3705 ,0x1a);
write_i2c(0x3905 ,0x02);
write_i2c(0x3906 ,0x10);
write_i2c(0x3901 ,0x0a);
write_i2c(0x3731 ,0x12);
write_i2c(0x3600 ,0x08);
write_i2c(0x3601 ,0x33);
write_i2c(0x302d ,0x60);
write_i2c(0x3620 ,0x52);
write_i2c(0x371b ,0x20);
write_i2c(0x471c ,0x50);
write_i2c(0x3a13 ,0x43);
write_i2c(0x3a18 ,0x00);
write_i2c(0x3a19 ,0xf8);
write_i2c(0x3635 ,0x13);
write_i2c(0x3636 ,0x03);
write_i2c(0x3634 ,0x40);
write_i2c(0x3622 ,0x01);
//ConfidentialForActionsOnly
write_i2c(0x3c01 ,0x34);
write_i2c(0x3c04 ,0x28);
write_i2c(0x3c05 ,0x98);
write_i2c(0x3c06 ,0x00);
write_i2c(0x3c07 ,0x08);
write_i2c(0x3c08 ,0x00);
write_i2c(0x3c09 ,0x1c);
write_i2c(0x3c0a ,0x9c);
write_i2c(0x3c0b ,0x40);
write_i2c(0x3820 ,0x41);
write_i2c(0x3821 ,0x07);
write_i2c(0x3814 ,0x31);
write_i2c(0x3815 ,0x31);
write_i2c(0x3800 ,0x00);
write_i2c(0x3801 ,0x00);
write_i2c(0x3802 ,0x00);
write_i2c(0x3803 ,0x04);
write_i2c(0x3804 ,0x0a);
write_i2c(0x3805 ,0x3f);
write_i2c(0x3806 ,0x07);
write_i2c(0x3807 ,0x9b);
write_i2c(0x3808 ,0x02);
write_i2c(0x3809 ,0x80);
write_i2c(0x380a ,0x01);
write_i2c(0x380b ,0xe0);
write_i2c(0x380c ,0x07);
write_i2c(0x380d ,0x68);
write_i2c(0x380e ,0x03);
write_i2c(0x380f ,0xd8);
write_i2c(0x3810 ,0x00);
write_i2c(0x3811 ,0x10);
write_i2c(0x3812 ,0x00);
write_i2c(0x3813 ,0x06);
write_i2c(0x3618 ,0x00);
write_i2c(0x3612 ,0x29);
write_i2c(0x3708 ,0x64);
write_i2c(0x3709 ,0x52);
write_i2c(0x370c ,0x03);
write_i2c(0x3a02 ,0x03);
write_i2c(0x3a03 ,0xd8);
write_i2c(0x3a08 ,0x01);
write_i2c(0x3a09 ,0x27);
write_i2c(0x3a0a ,0x00);
write_i2c(0x3a0b ,0xf6);
write_i2c(0x3a0e ,0x03);
write_i2c(0x3a0d ,0x04);
write_i2c(0x3a14 ,0x03);
write_i2c(0x3a15 ,0xd8);
//ConfidentialForActionsOnly
write_i2c(0x4001 ,0x02);
write_i2c(0x4004 ,0x02);
write_i2c(0x3000 ,0x00);
write_i2c(0x3002 ,0x1c);
write_i2c(0x3004 ,0xff);
write_i2c(0x3006 ,0xc3);
write_i2c(0x300e ,0x58);
write_i2c(0x302e ,0x00);
write_i2c(0x4300 ,0x30);
write_i2c(0x501f ,0x00);
write_i2c(0x4713 ,0x03);
write_i2c(0x4407 ,0x02);
write_i2c(0x440e ,0x00);
write_i2c(0x460b ,0x35);
write_i2c(0x460c ,0x22);
write_i2c(0x3824 ,0x02);
write_i2c(0x5000 ,0xa7);
write_i2c(0x5001 ,0xa3);
write_i2c(0x5180 ,0xff);
write_i2c(0x5181 ,0xf2);
write_i2c(0x5182 ,0x00);
write_i2c(0x5183 ,0x14);
write_i2c(0x5184 ,0x25);
write_i2c(0x5185 ,0x24);
write_i2c(0x5186 ,0x09);
write_i2c(0x5187 ,0x09);
write_i2c(0x5188 ,0x09);
write_i2c(0x5189 ,0x75);
write_i2c(0x518a ,0x54);
write_i2c(0x518b ,0xe0);
write_i2c(0x518c ,0xb2);
write_i2c(0x518d ,0x42);
write_i2c(0x518e ,0x3d);
write_i2c(0x518f ,0x56);
write_i2c(0x5190 ,0x46);
write_i2c(0x5191 ,0xf8);
write_i2c(0x5192 ,0x04);
write_i2c(0x5193 ,0x70);
write_i2c(0x5194 ,0xf0);
write_i2c(0x5195 ,0xf0);
write_i2c(0x5196 ,0x03);
write_i2c(0x5197 ,0x01);
write_i2c(0x5198 ,0x04);
write_i2c(0x5199 ,0x12);
write_i2c(0x519a ,0x04);
write_i2c(0x519b ,0x00);
write_i2c(0x519c ,0x06);
write_i2c(0x519d ,0x82);
//ConfidentialForActionsOnly
write_i2c(0x519e ,0x38);
write_i2c(0x5381 ,0x1e);
write_i2c(0x5382 ,0x5b);
write_i2c(0x5383 ,0x08);
write_i2c(0x5384 ,0x0a);
write_i2c(0x5385 ,0x7e);
write_i2c(0x5386 ,0x88);
write_i2c(0x5387 ,0x7c);
write_i2c(0x5388 ,0x6c);
write_i2c(0x5389 ,0x10);
write_i2c(0x538a ,0x01);
write_i2c(0x538b ,0x98);
write_i2c(0x5300 ,0x08);
write_i2c(0x5301 ,0x30);
write_i2c(0x5302 ,0x10);
write_i2c(0x5303 ,0x00);
write_i2c(0x5304 ,0x08);
write_i2c(0x5305 ,0x30);
write_i2c(0x5306 ,0x08);
write_i2c(0x5307 ,0x16);
write_i2c(0x5309 ,0x08);
write_i2c(0x530a ,0x30);
write_i2c(0x530b ,0x04);
write_i2c(0x530c ,0x06);
write_i2c(0x5480 ,0x01);
write_i2c(0x5481 ,0x08);
write_i2c(0x5482 ,0x14);
write_i2c(0x5483 ,0x28);
write_i2c(0x5484 ,0x51);
write_i2c(0x5485 ,0x65);
write_i2c(0x5486 ,0x71);
write_i2c(0x5487 ,0x7d);
write_i2c(0x5488 ,0x87);
write_i2c(0x5489 ,0x91);
write_i2c(0x548a ,0x9a);
write_i2c(0x548b ,0xaa);
write_i2c(0x548c ,0xb8);
write_i2c(0x548d ,0xcd);
write_i2c(0x548e ,0xdd);
write_i2c(0x548f ,0xea);
write_i2c(0x5490 ,0x1d);
write_i2c(0x5580 ,0x02);
write_i2c(0x5583 ,0x40);
write_i2c(0x5584 ,0x10);
write_i2c(0x5589 ,0x10);
write_i2c(0x558a ,0x00);
write_i2c(0x558b ,0xf8);
write_i2c(0x5800 ,0x23);
//ConfidentialForActionsOnly
//write_i2c(0x5801 ,0x14);
//write_i2c(0x5802 ,0x0f);
//write_i2c(0x5803 ,0x0f);
//write_i2c(0x5804 ,0x12);
//write_i2c(0x5805 ,0x26);
//write_i2c(0x5806 ,0x0c);
//write_i2c(0x5807 ,0x08);
//write_i2c(0x5808 ,0x05);
//write_i2c(0x5809 ,0x05);
//write_i2c(0x580a ,0x08);
//write_i2c(0x580b ,0x0d);
//write_i2c(0x580c ,0x08);
//write_i2c(0x580d ,0x03);
//write_i2c(0x580e ,0x00);
//write_i2c(0x580f ,0x00);
write_i2c(0x5810 ,0x03);
write_i2c(0x5811 ,0x09);
write_i2c(0x5812 ,0x07);
write_i2c(0x5813 ,0x03);
write_i2c(0x5814 ,0x00);
write_i2c(0x5815 ,0x01);
write_i2c(0x5816 ,0x03);
write_i2c(0x5817 ,0x08);
write_i2c(0x5818 ,0x0d);
write_i2c(0x5819 ,0x08);
write_i2c(0x581a ,0x05);
write_i2c(0x581b ,0x06);
write_i2c(0x581c ,0x08);
write_i2c(0x581d ,0x0e);
write_i2c(0x581e ,0x29);
write_i2c(0x581f ,0x17);
write_i2c(0x5820 ,0x11);
write_i2c(0x5821 ,0x11);
write_i2c(0x5822 ,0x15);
write_i2c(0x5823 ,0x28);
write_i2c(0x5824 ,0x46);
write_i2c(0x5825 ,0x26);
write_i2c(0x5826 ,0x08);
write_i2c(0x5827 ,0x26);
write_i2c(0x5828 ,0x64);
write_i2c(0x5829 ,0x26);
write_i2c(0x582a ,0x24);
write_i2c(0x582b ,0x22);
write_i2c(0x582c ,0x24);
write_i2c(0x582d ,0x24);
write_i2c(0x582e ,0x06);
write_i2c(0x582f ,0x22);
write_i2c(0x5830 ,0x40);
//ConfidentialForActionsOnly
write_i2c(0x5831 ,0x42);
write_i2c(0x5832 ,0x24);
write_i2c(0x5833 ,0x26);
write_i2c(0x5834 ,0x24);
write_i2c(0x5835 ,0x22);
write_i2c(0x5836 ,0x22);
write_i2c(0x5837 ,0x26);
write_i2c(0x5838 ,0x44);
write_i2c(0x5839 ,0x24);
write_i2c(0x583a ,0x26);
write_i2c(0x583b ,0x28);
write_i2c(0x583c ,0x42);
write_i2c(0x583d ,0xce);
write_i2c(0x5025 ,0x00);
write_i2c(0x3a0f ,0x30);
write_i2c(0x3a10 ,0x28);
write_i2c(0x3a1b ,0x30);
write_i2c(0x3a1e ,0x26);
write_i2c(0x3a11 ,0x60);
write_i2c(0x3a1f ,0x14);
write_i2c(0x3008 ,0x02);
write_i2c(0x3035 ,0x21);
//Band,0x50Hz
write_i2c(0x3c01,0xb4);
write_i2c(0x3c00,0x04);
//gain ceiling
write_i2c(0x3a19,0x7c);
//OV5640 LENC setting
write_i2c(0x5800 ,0x2c);
write_i2c(0x5801 ,0x17);
write_i2c(0x5802 ,0x11);
write_i2c(0x5803 ,0x11);
write_i2c(0x5804 ,0x15);
write_i2c(0x5805 ,0x29);
write_i2c(0x5806 ,0x08);
write_i2c(0x5807 ,0x06);
write_i2c(0x5808 ,0x04);
write_i2c(0x5809 ,0x04);
write_i2c(0x580a ,0x05);
write_i2c(0x580b ,0x07);
write_i2c(0x580c ,0x06);
write_i2c(0x580d ,0x03);
write_i2c(0x580e ,0x01);
write_i2c(0x580f ,0x01);
write_i2c(0x5810 ,0x03);
write_i2c(0x5811 ,0x06);
//ConfidentialForActionsOnly
write_i2c(0x5812 ,0x06);
write_i2c(0x5813 ,0x02);
write_i2c(0x5814 ,0x01);
write_i2c(0x5815 ,0x01);
write_i2c(0x5816 ,0x04);
write_i2c(0x5817 ,0x07);
write_i2c(0x5818 ,0x06);
write_i2c(0x5819 ,0x07);
write_i2c(0x581a ,0x06);
write_i2c(0x581b ,0x06);
write_i2c(0x581c ,0x06);
write_i2c(0x581d ,0x0e);
write_i2c(0x581e ,0x31);
write_i2c(0x581f ,0x12);
write_i2c(0x5820 ,0x11);
write_i2c(0x5821 ,0x11);
write_i2c(0x5822 ,0x11);
write_i2c(0x5823 ,0x2f);
write_i2c(0x5824 ,0x12);
write_i2c(0x5825 ,0x25);
write_i2c(0x5826 ,0x39);
write_i2c(0x5827 ,0x29);
write_i2c(0x5828 ,0x27);
write_i2c(0x5829 ,0x39);
write_i2c(0x582a ,0x26);
write_i2c(0x582b ,0x33);
write_i2c(0x582c ,0x24);
write_i2c(0x582d ,0x39);
write_i2c(0x582e ,0x28);
write_i2c(0x582f ,0x21);
write_i2c(0x5830 ,0x40);
write_i2c(0x5831 ,0x21);
write_i2c(0x5832 ,0x17);
write_i2c(0x5833 ,0x17);
write_i2c(0x5834 ,0x15);
write_i2c(0x5835 ,0x11);
write_i2c(0x5836 ,0x24);
write_i2c(0x5837 ,0x27);
write_i2c(0x5838 ,0x26);
write_i2c(0x5839 ,0x26);
write_i2c(0x583a ,0x26);
write_i2c(0x583b ,0x28);
write_i2c(0x583c ,0x14);
write_i2c(0x583d ,0xee);
write_i2c(0x4005 ,0x1a);
//color
write_i2c(0x5381,0x26);
write_i2c(0x5382,0x50);
//ConfidentialForActionsOnly
write_i2c(0x5383,0x0c);
write_i2c(0x5384,0x09);
write_i2c(0x5385,0x74);
write_i2c(0x5386,0x7d);
write_i2c(0x5387,0x7e);
write_i2c(0x5388,0x75);
write_i2c(0x5389,0x09);
write_i2c(0x538b,0x98);
write_i2c(0x538a,0x01);
//UVAdjust Auto Mode
write_i2c(0x5580,0x02);
write_i2c(0x5588,0x01);
write_i2c(0x5583,0x40);
write_i2c(0x5584,0x10);
write_i2c(0x5589,0x0f);
write_i2c(0x558a,0x00);
write_i2c(0x558b,0x3f);
//De-Noise,0xAuto
write_i2c(0x5308,0x25);
write_i2c(0x5304,0x08);
write_i2c(0x5305,0x30);
write_i2c(0x5306,0x10);
write_i2c(0x5307,0x20);
//awb
write_i2c(0x5180,0xff);
write_i2c(0x5181,0xf2);
write_i2c(0x5182,0x11);
write_i2c(0x5183,0x14);
write_i2c(0x5184,0x25);
write_i2c(0x5185,0x24);
write_i2c(0x5186,0x10);
write_i2c(0x5187,0x12);
write_i2c(0x5188,0x10);
write_i2c(0x5189,0x80);
write_i2c(0x518a,0x54);
write_i2c(0x518b,0xb8);
write_i2c(0x518c,0xb2);
write_i2c(0x518d,0x42);
write_i2c(0x518e,0x3a);
write_i2c(0x518f,0x56);
write_i2c(0x5190,0x46);
write_i2c(0x5191,0xf0);
write_i2c(0x5192,0xf);
write_i2c(0x5193,0x70);
//ConfidentialForActionsOnly
write_i2c(0x5194,0xf0);
write_i2c(0x5195,0xf0);
write_i2c(0x5196,0x3);
write_i2c(0x5197,0x1);
write_i2c(0x5198,0x6);
write_i2c(0x5199,0x62);
write_i2c(0x519a,0x4);
write_i2c(0x519b,0x0);
write_i2c(0x519c,0x4);
write_i2c(0x519d,0xe7);
write_i2c(0x519e,0x38);

//to qvga
write_i2c(0x3800 ,0x0 );
write_i2c(0x3801 ,0x0 );
write_i2c(0x3802 ,0x0 );
write_i2c(0x3803 ,0x4 );
write_i2c(0x3804 ,0xa );
write_i2c(0x3805 ,0x3f);
write_i2c(0x3806 ,0x7 );
write_i2c(0x3807 ,0x9b);
write_i2c(0x3808 ,0x1 );
write_i2c(0x3809 ,0x40);
write_i2c(0x380a ,0x0 );
write_i2c(0x380b ,0xf0);
write_i2c(0x380c ,0x7 );
write_i2c(0x380d ,0x68);
write_i2c(0x380e ,0x3 );
write_i2c(0x380f ,0xd8);

}

void qsxga_capture()//jpeg mode
{
		write_i2c(0x3820 ,0x40);
write_i2c(0x3821 ,0x26);
write_i2c(0x3814 ,0x11);
write_i2c(0x3815 ,0x11);
write_i2c(0x3803 ,0x00);
write_i2c(0x3807 ,0x9f);
write_i2c(0x3808 ,0x0a);
write_i2c(0x3809 ,0x20);
write_i2c(0x380a ,0x07);
write_i2c(0x380b ,0x98);
write_i2c(0x380c ,0x0b);
write_i2c(0x380d ,0x1c);
write_i2c(0x380e ,0x07);
write_i2c(0x380f ,0xb0);
write_i2c(0x3813 ,0x04);
write_i2c(0x3618 ,0x04);
write_i2c(0x3612 ,0x4b);
write_i2c(0x3708 ,0x64);
write_i2c(0x3709 ,0x12);
write_i2c(0x370c ,0x00);
write_i2c(0x3a02 ,0x07);
write_i2c(0x3a03 ,0xb0);
write_i2c(0x3a0e ,0x06);
write_i2c(0x3a0d ,0x08);
write_i2c(0x3a14 ,0x07);
write_i2c(0x3a15 ,0xb0);
write_i2c(0x4001 ,0x02);
write_i2c(0x4004 ,0x06);
write_i2c(0x3002 ,0x00);
write_i2c(0x3006 ,0xff);
write_i2c(0x3824 ,0x04);
write_i2c(0x5001 ,0x83);
write_i2c(0x3036 ,0x69);
//ConfidentialForActionsOnly
write_i2c(0x3035 ,0x31);
write_i2c(0x4005 ,0x1A);
}
void qxga_capture()
{
	qsxga_capture();
	//to qxga
	write_i2c(0x3800 ,0x00);
write_i2c(0x3801 ,0x00);
write_i2c(0x3802 ,0x00);
write_i2c(0x3803 ,0x00);
write_i2c(0x3804 ,0xA );
write_i2c(0x3805 ,0x3f);
write_i2c(0x3806 ,0x7 );
write_i2c(0x3807 ,0x9f);
write_i2c(0x3808 ,0x8 );
write_i2c(0x3809 ,0x0 );
write_i2c(0x380a ,0x6 );
write_i2c(0x380b ,0x0 );
write_i2c(0x380c ,0xc );
write_i2c(0x380d ,0x80);
write_i2c(0x380e ,0x7 );
write_i2c(0x380f ,0xd0);
write_i2c(0x5001 ,0xa3);
write_i2c(0x5680 ,0x0 );
write_i2c(0x5681 ,0x0 );
write_i2c(0x5682 ,0xA );
write_i2c(0x5683 ,0x20);
write_i2c(0x5684 ,0x0 );
write_i2c(0x5685 ,0x0 );
write_i2c(0x5686 ,0x7 );
write_i2c(0x5687 ,0x98);

//write_i2c(0x3810, 0);
//write_i2c(0x3811, 0x20);
//write_i2c(0x3812, 0);
//write_i2c(0x3813, 0x08);
}
void xga_capture()
{
	qsxga_capture();
	write_i2c(0x3800 ,0x00);
write_i2c(0x3801 ,0x00);
write_i2c(0x3802 ,0x00);
write_i2c(0x3803 ,0x00);
write_i2c(0x3804 ,0xA );
write_i2c(0x3805 ,0x3f);
write_i2c(0x3806 ,0x7 );
write_i2c(0x3807 ,0x9f);
write_i2c(0x3808 ,0x4 );
write_i2c(0x3809 ,0x0 );
write_i2c(0x380a ,0x3 );
write_i2c(0x380b ,0x0 );
write_i2c(0x380c ,0xc );
write_i2c(0x380d ,0x80);
write_i2c(0x380e ,0x7 );
write_i2c(0x380f ,0xd0);
write_i2c(0x5001 ,0xa3);
write_i2c(0x5680 ,0x0 );
write_i2c(0x5681 ,0x0 );
write_i2c(0x5682 ,0xA );
write_i2c(0x5683 ,0x20);
write_i2c(0x5684 ,0x0 );
write_i2c(0x5685 ,0x0 );
write_i2c(0x5686 ,0x7 );
write_i2c(0x5687 ,0x98);
}
void qvga_capture()
{
	qsxga_capture();
write_i2c(0x3800 ,0x00);
write_i2c(0x3801 ,0x00);
write_i2c(0x3802 ,0x00);
write_i2c(0x3803 ,0x00);
write_i2c(0x3804 ,0xA );
write_i2c(0x3805 ,0x3f);
write_i2c(0x3806 ,0x7 );
write_i2c(0x3807 ,0x9f);
write_i2c(0x3808 ,0x1 );
write_i2c(0x3809 ,0x40);
write_i2c(0x380a ,0x0 );
write_i2c(0x380b ,0xf0);
write_i2c(0x380c ,0xc );
write_i2c(0x380d ,0x80);
write_i2c(0x380e ,0x7 );
write_i2c(0x380f ,0xd0);
write_i2c(0x5001 ,0xa3);
write_i2c(0x5680 ,0x0 );
write_i2c(0x5681 ,0x0 );
write_i2c(0x5682 ,0xA );
write_i2c(0x5683 ,0x20);
write_i2c(0x5684 ,0x0 );
write_i2c(0x5685 ,0x0 );
write_i2c(0x5686 ,0x7 );
write_i2c(0x5687 ,0x98);
}
void vga_capture()
{
	qsxga_capture();
	write_i2c(0x3800 ,0x00);
write_i2c(0x3801 ,0x00);
write_i2c(0x3802 ,0x00);
write_i2c(0x3803 ,0x00);
write_i2c(0x3804 ,0xA );
write_i2c(0x3805 ,0x3f);
write_i2c(0x3806 ,0x7 );
write_i2c(0x3807 ,0x9f);
write_i2c(0x3808 ,0x2 );
write_i2c(0x3809 ,0x80);
write_i2c(0x380a ,0x1 );
write_i2c(0x380b ,0xe0);
write_i2c(0x380c ,0xc );
write_i2c(0x380d ,0x80);
write_i2c(0x380e ,0x7 );
write_i2c(0x380f ,0xd0);
write_i2c(0x5001 ,0xa3);
write_i2c(0x5680 ,0x0 );
write_i2c(0x5681 ,0x0 );
write_i2c(0x5682 ,0xA );
write_i2c(0x5683 ,0x20);
write_i2c(0x5684 ,0x0 );
write_i2c(0x5685 ,0x0 );
write_i2c(0x5686 ,0x7 );
write_i2c(0x5687 ,0x98);
}
void I2c_mode()
{
	write_i2c(0x3b07 ,0x09);
write_i2c(0x3016 ,0x02);
write_i2c(0x3017 ,0xff);
write_i2c(0x3709 ,0x10);
write_i2c(0x3b04 ,0x04);
write_i2c(0x3b05 ,0x00);
}
void Pad_mode()
{
write_i2c(0x3016 ,0x02);
write_i2c(0x3017 ,0x7f);
write_i2c(0x3079 ,0x10);
write_i2c(0x471d ,0x02);
write_i2c(0x302c ,0x00);
}
/* OV7670_init() */
//返回1 成功
unsigned char CF5642C_init(void)
{
		unsigned char temp;

		CF5642C_GPIO_Init();
    CF5642C_DCMI_Init();
		CF5642C_DMA_Init();
	
		SCCB_GPIO_Init();//io init..
					 
		if(0==Read_i2c(0x300A, &temp))//读ID
		{
			return 0 ;//错误返回
		}      
				 
		if(0==Read_i2c(0x300B, &temp))//读ID
		{
			return 0 ;//错误返回
		}
					 
		if(0==write_i2c(0x3008, 0x80))
    {
			return 0 ;
		} 

	//	QVGA_rgb565_Preview();
		qvga_yuv_preview();
		//yuv to jpeg
		
		write_i2c(0x3002 ,0x00);
		write_i2c(0x3006 ,0xff);
		write_i2c(0x3821 ,0x27);
		write_i2c(0x4300 ,0x30);
		write_i2c(0x501f ,0x00);
		write_i2c(0x4713 ,0x02);
		write_i2c(0x460c ,0x22);
		write_i2c(0x3824 ,0x04);
		write_i2c(0x460b ,0x35);
		
		//I2c_mode();
//		write_i2c(0x503d , 0x80);
//    write_i2c(0x503e, 0x00);
//		VGA_jpeg_Preview();
//		XGA_jpeg_Preview();
		//Cam_Frex();
		//write_i2c(0x503d, 0x80);
		//write_i2c(0x4741, 0x00);
		rt_kprintf("camera ok!\n");
		//while(1);
		return 0x01; //ok
} 

void Cam_Start(void)
{
  	DMA_Cmd(DMA2_Stream1, ENABLE); 
  	DCMI_Cmd(ENABLE); 
  	DCMI_CaptureCmd(ENABLE); 
}
void Cam_Stop(void)
{
		DMA_Cmd(DMA2_Stream1, DISABLE); 
  	DCMI_Cmd(DISABLE); 
  	DCMI_CaptureCmd(DISABLE); 
}
#define Capture_Framerate	500
#define Preview_FrameRate	1500
extern int fenbianlv;
void Cam_Capture(void)
{
		int i=0;
		uint8_t Gain,CaptureMaxlineLow,CaptureMaxlineHigh,PreviewMaxlineHigh,PreviewMaxlineLow,ExposureLow,ExposureMid,ExposureHigh;
	  int Preview_MaxLines,Capture_MaxLines,Lines_10ms;
		long ulCapture_Exposure,ulCapture_Exposure_Gain,ulPreviewExposure,iCapture_Gain;
		
		write_i2c(0x3503, 0x07);//to stop AGC/AEC
//		Read_i2c(0x350b,&Gain); 
//		I2c_mode();
			
	Preview_MaxLines = 320;//980;
//		Capture_MaxLines = 1964;
//		write_i2c(0x3503, 0x07);//to stop AGC/AEC
		Read_i2c(0x350b,&Gain);  
	  Read_i2c(0x3502,&ExposureLow);  
		Read_i2c(0x3501,&ExposureMid);  
	  Read_i2c(0x3500,&ExposureHigh);  
//		Read_i2c(0x350c,&PreviewMaxlineHigh);
//		Read_i2c(0x350d,&PreviewMaxlineLow);
		//download capture setting below
		//if(First_Capture)
		//{	
			I2c_mode();
			switch(fenbianlv)
			{
				case 0:qvga_capture();
							 goto CAPTURE;break;
				case 1:vga_capture();break;
				case 2:xga_capture();break;
				case 3:qxga_capture();break;
				default:break;
			}
		//First_Capture=0;
		//}
		Read_i2c(0x3808,&CaptureMaxlineHigh);//380e
		Read_i2c(0x3809,&CaptureMaxlineLow);//380f
	//	Preview_MaxLines = 256*PreviewMaxlineHigh + PreviewMaxlineLow;
		Capture_MaxLines = 256*CaptureMaxlineHigh + CaptureMaxlineLow;
		Lines_10ms = Capture_Framerate * Capture_MaxLines/10000*13/12;
		
		ulPreviewExposure = ((unsigned long)(ExposureHigh))<<12 ;
		ulPreviewExposure += ((unsigned long)ExposureMid)<<4 ;
		ulPreviewExposure += (ExposureLow >>4);
		if(0 == Preview_MaxLines ||0 ==Preview_FrameRate ||0== Lines_10ms)
		{
		 return;
		}
		 ulCapture_Exposure =
		(ulPreviewExposure*(Capture_Framerate)*(Capture_MaxLines))/(((Preview_MaxLines)*(Preview_FrameRate)))*6/5;
		iCapture_Gain = Gain;	
		ulCapture_Exposure_Gain = ulCapture_Exposure * iCapture_Gain;
		
		if(ulCapture_Exposure_Gain < ((unsigned long)(Capture_MaxLines)*16))
		{
		 ulCapture_Exposure = ulCapture_Exposure_Gain/16;
		 if (ulCapture_Exposure > Lines_10ms)
		 {
		 ulCapture_Exposure /= Lines_10ms;
		 ulCapture_Exposure *= Lines_10ms;
		 }
		}
		else
		{
		 ulCapture_Exposure = Capture_MaxLines;
		}
		if(ulCapture_Exposure == 0)
		{
		 ulCapture_Exposure = 1;
		}
		iCapture_Gain = (ulCapture_Exposure_Gain*2/ulCapture_Exposure + 1)/2;
		ExposureLow = ((uint8_t)ulCapture_Exposure)<<4;
		ExposureMid = (uint8_t)(ulCapture_Exposure >> 4) & 0xff;
		ExposureHigh = (uint8_t)(ulCapture_Exposure >> 12);
		Gain = (uint8_t)iCapture_Gain;
		// write the gain and exposure to 0x350* registers
CAPTURE:	
		write_i2c(0x350b, Gain);
		write_i2c(0x3b05, ExposureLow);
		write_i2c(0x3b04, ExposureMid);
		write_i2c(0x3b01, ExposureHigh);
		
//		write_i2c(0x3b05, 0x00);
//		write_i2c(0x3b04, 0x08);
//		write_i2c(0x3b01, 0x00);
		
		DCMI_Cmd(ENABLE); 
  	DCMI_CaptureCmd(ENABLE);
		Cam_Frex();
		//rt_thread_delay(1); 
	  //capture_done=0;
		//write_i2c(0x3503,0x07);
		//DMA_Cmd(DMA2_Stream1, ENABLE); 
//		write_i2c(0x3b08, 0xff);//frex shuter on
////		write_i2c(0x3b00, 0x00);//frex shuter on
////		write_i2c(0x3b00, 0x80);
//	  //DMA_Cmd(DMA2_Stream1, ENABLE);
//		//rt_thread_delay(50);
//		while(!capture_done){}
//		write_i2c(0x3b00, 0x00);

}

void Cam_Frex()
{
	frex_send_ok=1;
	write_i2c(0x3b08,0xff);	
	
}

